<script setup>
import naver from '@/assets/icon/social/naver.png';
import kakao from '@/assets/icon/social/kakao.png';
import {ref} from 'vue';
import axios from "axios";

// 새로운 창을 열어 URL로 이동하는 함수
const openInNewWindow = (url, provider) => {
  window.open(url, '_blank');
  window.addEventListener('message', (event) => {
    if (event.origin !== window.location.origin) return;
    const {token} = event.data;
    if (token) {
      localStorage.setItem(`${provider}_token`, token);
    }
  });
};

// 구글 로그인 URL 생성
const googleLoginUrl = ref("http://calit.kro.kr/oauth2/authorization/google")
// 네이버 로그인 URL 생성
const naverLoginUrl = ref("http://calit.kro.kr/oauth2/authorization/naver")
// 카카오 로그인 URL 생성
const kakaoLoginUrl = ref("http://calit.kro.kr/oauth2/authorization/kakao")

const sendGoogleRequest = async () => {
  try {
    const response = await axios.post('/api/oauth2/authorization/google');
    console.log(response.data);
  } catch (error) {
    console.error('Error sending request to Kakao:', error);
  }
};

const sendNaverRequest = async () => {
  try {
    const response = await axios.post('/oauth2/authorization/naver');
    console.log(response.data);
  } catch (error) {
    console.error('Error sending request to Kakao:', error);
  }
};

const sendKakaoRequest = async () => {
  try {
    const response = await axios.post('/oauth2/authorization/kakao');
    console.log(response.data);
  } catch (error) {
    console.error('Error sending request to Kakao:', error);
  }
};
</script>

<template>
  <div>
    <hr>
    <div class="social-login">
      <div class="social-login_title">소셜 로그인</div>
      <div class="social-login_content">
        <!-- 구글 로그인 버튼 -->
        <div
            @click="openInNewWindow(googleLoginUrl, 'google');"
            class="social-login_content_item"
        >
          <div class="social-login_content_item_icon">
            <img src="https://img.icons8.com/color/48/000000/google-logo.png" alt="구글로고"/>
          </div>
          <div class="social-login_content_item_text">구글 로그인</div>
        </div>

        <!-- 네이버 로그인 버튼 -->
        <div
            @click="openInNewWindow(naverLoginUrl, 'naver'); sendNaverRequest()"
            class="social-login_content_item"
        >
          <div class="social-login_content_item_icon">
            <img :src="naver" alt="naver logo"/>
          </div>
          <div class="social-login_content_item_text">네이버 로그인</div>
        </div>

        <!-- 카카오 로그인 버튼 -->
        <div
            @click="openInNewWindow(kakaoLoginUrl, 'kakao'); sendKakaoRequest()"
            class="social-login_content_item"
        >
          <div class="social-login_content_item_icon">
            <img :src="kakao" alt="kakao"/>
          </div>
          <div class="social-login_content_item_text">카카오 로그인</div>
        </div>
      </div>
    </div>
  </div>
</template>


<style scoped>
a {
  text-decoration: none;
  color: #28303F;
}

hr {
  border: 1px solid #D7DBEC;
  width: 100%;
  margin: 10px 0;
  box-sizing: border-box;
}

.row {
  display: flex;
  gap: 10px;
}

.social-login {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}

.social-login_title {
  font-size: 15px;
  margin-bottom: 10px;
}

.social-login_content {
  width: 100%;
  display: flex;
  gap: 10px;
  box-sizing: border-box;
  overflow: hidden;
}

.social-login_content_item {
  display: flex;
  gap: 10px;
  align-items: center;
  width: 100%;
  border: 1px solid #D7DBEC;
  border-radius: 4px;
  justify-content: center;
  padding: 10px;
  cursor: pointer;
}

.social-login_content_item_icon {
  width: 24px;
  height: 24px;
}

.social-login_content_item_icon img {
  width: 100%;
  height: 100%;
}

.social-login_content_item_text {
  font-size: 16px;
}
</style>